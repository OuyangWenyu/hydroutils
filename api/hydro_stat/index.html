
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://zhuanglaihong.github.io/hydroutils/api/hydro_stat/">
      
      
        <link rel="prev" href="../hydroutils/">
      
      
        <link rel="next" href="../hydro_plot/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>Statistical Analysis - hydroutils</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="preference" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hydro_stat" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="hydroutils" class="md-header__button md-logo" aria-label="hydroutils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            hydroutils
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Statistical Analysis
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/zhuanglaihong/hydroutils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="hydroutils" class="md-nav__button md-logo" aria-label="hydroutils" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    hydroutils
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/zhuanglaihong/hydroutils" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick Start
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydroutils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Core Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Core Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Statistical Analysis
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Statistical Analysis
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#error-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Error Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kge" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-duration-curves" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Duration Curves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flow Duration Curves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_fdc" class="md-nav__link">
    <span class="md-ellipsis">
      cal_fdc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peak-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Peak Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peak Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      mean_peak_timing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistical-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Statistical Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Data Transformations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Data Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribution-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Distribution Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distribution Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat" class="md-nav__link">
    <span class="md-ellipsis">
      hydro_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.KGE" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.add_metric" class="md-nav__link">
    <span class="md-ellipsis">
      add_metric
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_metric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.add_metric--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_fdc" class="md-nav__link">
    <span class="md-ellipsis">
      cal_fdc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error" class="md-nav__link">
    <span class="md-ellipsis">
      flood_peak_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_peak_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      flood_peak_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_peak_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error" class="md-nav__link">
    <span class="md-ellipsis">
      flood_volume_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_volume_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias" class="md-nav__link">
    <span class="md-ellipsis">
      pbias
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pbias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error_i" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error_i
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trans_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--normalization-example" class="md-nav__link">
    <span class="md-ellipsis">
      Normalization example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_plot/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_time/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Time Processing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_file/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    File Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Advanced Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Advanced Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_arithmetric.md" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Mathematical Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_s3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    AWS S3 Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hydro_log/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Logging Utilities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Development
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Changelog
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/OuyangWenyu/hydroutils/issues" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Report Issues
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#error-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      Error Metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Error Metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kge" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#flow-duration-curves" class="md-nav__link">
    <span class="md-ellipsis">
      Flow Duration Curves
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Flow Duration Curves">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_fdc" class="md-nav__link">
    <span class="md-ellipsis">
      cal_fdc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#peak-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Peak Analysis
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Peak Analysis">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mean_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      mean_peak_timing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#statistical-tests" class="md-nav__link">
    <span class="md-ellipsis">
      Statistical Tests
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Statistical Tests">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-transformations" class="md-nav__link">
    <span class="md-ellipsis">
      Data Transformations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Transformations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-statistics" class="md-nav__link">
    <span class="md-ellipsis">
      Basic Statistics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic Statistics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#data-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Data Processing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Data Processing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#distribution-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Distribution Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Distribution Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#api-reference" class="md-nav__link">
    <span class="md-ellipsis">
      API Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat" class="md-nav__link">
    <span class="md-ellipsis">
      hydro_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.KGE" class="md-nav__link">
    <span class="md-ellipsis">
      KGE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.add_metric" class="md-nav__link">
    <span class="md-ellipsis">
      add_metric
    </span>
  </a>
  
    <nav class="md-nav" aria-label="add_metric">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.add_metric--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="md-nav__link">
    <span class="md-ellipsis">
      cal_4_stat_inds
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_fdc" class="md-nav__link">
    <span class="md-ellipsis">
      cal_fdc
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_gamma
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="md-nav__link">
    <span class="md-ellipsis">
      cal_stat_prcp_norm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.ecdf" class="md-nav__link">
    <span class="md-ellipsis">
      ecdf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error" class="md-nav__link">
    <span class="md-ellipsis">
      flood_peak_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_peak_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing" class="md-nav__link">
    <span class="md-ellipsis">
      flood_peak_timing
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_peak_timing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_peak_timing--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error" class="md-nav__link">
    <span class="md-ellipsis">
      flood_volume_error
    </span>
  </a>
  
    <nav class="md-nav" aria-label="flood_volume_error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.flood_volume_error--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms" class="md-nav__link">
    <span class="md-ellipsis">
      fms
    </span>
  </a>
  
    <nav class="md-nav" aria-label="fms">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.fms--references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="md-nav__link">
    <span class="md-ellipsis">
      month_stat_for_daily_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias" class="md-nav__link">
    <span class="md-ellipsis">
      pbias
    </span>
  </a>
  
    <nav class="md-nav" aria-label="pbias">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias--parameters" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.pbias--returns" class="md-nav__link">
    <span class="md-ellipsis">
      Returns
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.remove_abnormal_data" class="md-nav__link">
    <span class="md-ellipsis">
      remove_abnormal_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_error_i" class="md-nav__link">
    <span class="md-ellipsis">
      stat_error_i
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.stat_errors" class="md-nav__link">
    <span class="md-ellipsis">
      stat_errors
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm" class="md-nav__link">
    <span class="md-ellipsis">
      trans_norm
    </span>
  </a>
  
    <nav class="md-nav" aria-label="trans_norm">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.trans_norm--normalization-example" class="md-nav__link">
    <span class="md-ellipsis">
      Normalization example
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="md-nav__link">
    <span class="md-ellipsis">
      wilcoxon_t_test_for_lst
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  


  
  


<h1 id="hydro_stat">hydro_stat<a class="headerlink" href="#hydro_stat" title="Permanent link">&para;</a></h1>
<p>The <code>hydro_stat</code> module provides statistical functions for hydrological data analysis, including error metrics, flow duration curves, and data transformations.</p>
<h2 id="error-metrics">Error Metrics<a class="headerlink" href="#error-metrics" title="Permanent link">&para;</a></h2>
<h3 id="stat_error">stat_error<a class="headerlink" href="#stat_error" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span>
</code></pre></div></td></tr></table></div>
<p>Calculates multiple error metrics between predicted and target values.</p>
<p><strong>Example:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>  <span class="c1"># 2 basins, 3 timesteps</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">3.1</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.2</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">5.9</span><span class="p">]])</span>
<span class="n">metrics</span> <span class="o">=</span> <span class="n">stat_error</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean RMSE: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">metrics</span><span class="p">[</span><span class="s1">&#39;RMSE&#39;</span><span class="p">])</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="stat_errors">stat_errors<a class="headerlink" href="#stat_errors" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_errors</span><span class="p">(</span><span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div></td></tr></table></div>
<p>Similar to stat_error but handles 3D arrays for multiple variables.</p>
<h3 id="kge">KGE<a class="headerlink" href="#kge" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">KGE</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div></td></tr></table></div>
<p>Calculates Kling-Gupta Efficiency between simulated and observed values.</p>
<h2 id="flow-duration-curves">Flow Duration Curves<a class="headerlink" href="#flow-duration-curves" title="Permanent link">&para;</a></h2>
<h3 id="cal_fdc">cal_fdc<a class="headerlink" href="#cal_fdc" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_fdc</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">quantile_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div></td></tr></table></div>
<p>Calculates flow duration curves for multiple time series.</p>
<p><strong>Example:</strong>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="n">flows</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">lognormal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">365</span><span class="p">))</span>  <span class="c1"># 2 locations, 365 days</span>
<span class="n">fdcs</span> <span class="o">=</span> <span class="n">cal_fdc</span><span class="p">(</span><span class="n">flows</span><span class="p">,</span> <span class="n">quantile_num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</code></pre></div></td></tr></table></div></p>
<h3 id="fms">fms<a class="headerlink" href="#fms" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fms</span><span class="p">(</span><span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sim</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div></td></tr></table></div>
<p>Calculates the slope of the middle section of the flow duration curve.</p>
<h2 id="peak-analysis">Peak Analysis<a class="headerlink" href="#peak-analysis" title="Permanent link">&para;</a></h2>
<h3 id="mean_peak_timing">mean_peak_timing<a class="headerlink" href="#mean_peak_timing" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">mean_peak_timing</span><span class="p">(</span>
    <span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">sim</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">window</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1D&quot;</span><span class="p">,</span>
    <span class="n">datetime_coord</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span>
</code></pre></div></td></tr></table></div>
<p>Calculates mean difference in peak flow timing between observed and simulated flows.</p>
<h2 id="statistical-tests">Statistical Tests<a class="headerlink" href="#statistical-tests" title="Permanent link">&para;</a></h2>
<h3 id="wilcoxon_t_test">wilcoxon_t_test<a class="headerlink" href="#wilcoxon_t_test" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span>
</code></pre></div></td></tr></table></div>
<p>Performs Wilcoxon signed-rank test on paired samples.</p>
<h3 id="wilcoxon_t_test_for_lst">wilcoxon_t_test_for_lst<a class="headerlink" href="#wilcoxon_t_test_for_lst" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test_for_lst</span><span class="p">(</span><span class="n">x_lst</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">rnd_num</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span>
</code></pre></div></td></tr></table></div>
<p>Performs pairwise Wilcoxon tests between all arrays in a list.</p>
<h2 id="data-transformations">Data Transformations<a class="headerlink" href="#data-transformations" title="Permanent link">&para;</a></h2>
<h3 id="cal_stat_gamma">cal_stat_gamma<a class="headerlink" href="#cal_stat_gamma" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div></td></tr></table></div>
<p>Transforms data to approximate normal distribution and calculates statistics.</p>
<h3 id="cal_stat_prcp_norm">cal_stat_prcp_norm<a class="headerlink" href="#cal_stat_prcp_norm" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_prcp_norm</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">meanprep</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div></td></tr></table></div>
<p>Normalizes data by mean precipitation and calculates statistics.</p>
<h3 id="trans_norm">trans_norm<a class="headerlink" href="#trans_norm" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trans_norm</span><span class="p">(</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">var_lst</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
    <span class="n">stat_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">to_norm</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div></td></tr></table></div>
<p>Normalizes or denormalizes data using pre-computed statistics.</p>
<h2 id="basic-statistics">Basic Statistics<a class="headerlink" href="#basic-statistics" title="Permanent link">&para;</a></h2>
<h3 id="cal_4_stat_inds">cal_4_stat_inds<a class="headerlink" href="#cal_4_stat_inds" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div></td></tr></table></div>
<p>Calculates four basic statistical indices for an array.</p>
<h3 id="cal_stat">cal_stat<a class="headerlink" href="#cal_stat" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span>
</code></pre></div></td></tr></table></div>
<p>Calculates basic statistics for an array, ignoring NaN values.</p>
<h2 id="data-processing">Data Processing<a class="headerlink" href="#data-processing" title="Permanent link">&para;</a></h2>
<h3 id="remove_abnormal_data">remove_abnormal_data<a class="headerlink" href="#remove_abnormal_data" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_abnormal_data</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">q1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span>
    <span class="n">q2</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99999</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div></td></tr></table></div>
<p>Removes extreme values from data using quantile thresholds.</p>
<h3 id="month_stat_for_daily_df">month_stat_for_daily_df<a class="headerlink" href="#month_stat_for_daily_df" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">month_stat_for_daily_df</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span>
</code></pre></div></td></tr></table></div>
<p>Calculates monthly statistics from daily data.</p>
<h2 id="distribution-functions">Distribution Functions<a class="headerlink" href="#distribution-functions" title="Permanent link">&para;</a></h2>
<h3 id="ecdf">ecdf<a class="headerlink" href="#ecdf" title="Permanent link">&para;</a></h3>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span>
</code></pre></div></td></tr></table></div>
<p>Computes empirical cumulative distribution function (ECDF).</p>
<h2 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="hydroutils.hydro_stat"></a>
    <div class="doc doc-contents first">

        <p>Author: MHPI group, Wenyu Ouyang
Date: 2021-12-31 11:08:29
LastEditTime: 2025-08-04 09:13:42
LastEditors: Wenyu Ouyang
Description: statistics calculation
FilePath: \hydroutils\hydroutils\hydro_stat.py
Copyright (c) 2021-2022 MHPI group, Wenyu Ouyang. All rights reserved.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.KGE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">KGE</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.KGE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Kling Gupta Efficiency (Gupta et al., 2009, http://dx.doi.org/10.1016/j.jhydrol.2009.08.003)
input:
    xs: simulated
    xo: observed
output:
    KGE: Kling Gupta Efficiency</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">KGE</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Kling Gupta Efficiency (Gupta et al., 2009, http://dx.doi.org/10.1016/j.jhydrol.2009.08.003)</span>
<span class="sd">    input:</span>
<span class="sd">        xs: simulated</span>
<span class="sd">        xo: observed</span>
<span class="sd">    output:</span>
<span class="sd">        KGE: Kling Gupta Efficiency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">xo</span><span class="p">,</span> <span class="n">xs</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xo</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">beta</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.add_metric" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_metric</span><span class="p">(</span><span class="n">func_name</span><span class="p">,</span> <span class="n">he_func_name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.add_metric" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p></p>
<h4 id="hydroutils.hydro_stat.add_metric--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.add_metric--parameters" title="Permanent link">&para;</a></h4>
<p>func_name : str
    
he_func_name : str
    HydroErr
description : str
    </p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_metric</span><span class="p">(</span><span class="n">func_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">he_func_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    </span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func_name : str</span>
<span class="sd">        </span>
<span class="sd">    he_func_name : str</span>
<span class="sd">        HydroErr</span>
<span class="sd">    description : str</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">he</span><span class="p">,</span> <span class="n">he_func_name</span><span class="p">):</span>
        <span class="n">metric_func</span> <span class="o">=</span> <span class="n">_create_metric_function</span><span class="p">(</span><span class="n">he_func_name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span><span class="n">current_module</span><span class="p">,</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">metric_func</span><span class="p">)</span>
        <span class="n">HYDRO_METRICS</span><span class="p">[</span><span class="n">func_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">he_func_name</span><span class="p">,</span> <span class="n">description</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: </span><span class="si">{</span><span class="n">func_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;: HydroErr </span><span class="si">{</span><span class="n">he_func_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_4_stat_inds" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_4_stat_inds" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate four basic statistical indices for an array.</p>
<p>This function computes four common statistical measures: 10th and 90th
percentiles, mean, and standard deviation. If the standard deviation is
very small (&lt; 0.001), it is set to 1 to avoid numerical issues.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>b</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array of numerical values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: Four statistical measures in order:
- p10: 10th percentile
- p90: 90th percentile
- mean: Arithmetic mean
- std: Standard deviation (minimum 0.001)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>NaN values should be removed before calling this function</li>
<li>If std &lt; 0.001, it is set to 1 to avoid division issues</li>
<li>All returned values are cast to float type</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])
p10, p90, mean, std = cal_4_stat_inds(data)
print(f"P10: {p10}, P90: {p90}, Mean: {mean}, Std: {std}")
P10: 1.9, P90: 9.1, Mean: 5.5, Std: 2.87</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate four basic statistical indices for an array.</span>

<span class="sd">    This function computes four common statistical measures: 10th and 90th</span>
<span class="sd">    percentiles, mean, and standard deviation. If the standard deviation is</span>
<span class="sd">    very small (&lt; 0.001), it is set to 1 to avoid numerical issues.</span>

<span class="sd">    Args:</span>
<span class="sd">        b (np.ndarray): Input array of numerical values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: Four statistical measures in order:</span>
<span class="sd">            - p10: 10th percentile</span>
<span class="sd">            - p90: 90th percentile</span>
<span class="sd">            - mean: Arithmetic mean</span>
<span class="sd">            - std: Standard deviation (minimum 0.001)</span>

<span class="sd">    Note:</span>
<span class="sd">        - NaN values should be removed before calling this function</span>
<span class="sd">        - If std &lt; 0.001, it is set to 1 to avoid division issues</span>
<span class="sd">        - All returned values are cast to float type</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10])</span>
<span class="sd">        &gt;&gt;&gt; p10, p90, mean, std = cal_4_stat_inds(data)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;P10: {p10}, P90: {p90}, Mean: {mean}, Std: {std}&quot;)</span>
<span class="sd">        P10: 1.9, P90: 9.1, Mean: 5.5, Std: 2.87</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">p10</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">p90</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mean</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">std</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">std</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="n">std</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">p10</span><span class="p">,</span> <span class="n">p90</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_fdc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_fdc</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">quantile_num</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_fdc" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate Flow Duration Curves (FDC) for multiple time series.</p>
<p>This function computes flow duration curves for multiple time series data,
typically used for analyzing streamflow characteristics. It handles NaN
values and provides a specified number of quantile points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.array">array</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array of shape [n_grid, n_day] containing time
series data for multiple locations/grids.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantile_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of quantile points to compute
for each FDC. Defaults to 100.</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Array of shape [n_grid, quantile_num] containing FDC
values for each location/grid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Data is sorted from high to low flow</li>
<li>NaN values are removed before processing</li>
<li>Empty series are filled with zeros</li>
<li>Quantiles are evenly spaced from 0 to 1</li>
<li>Output shape is always [n_grid, quantile_num]</li>
</ul>
</details>

<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="Exception">Exception</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If output flow array length doesn't match quantile_num.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([
...     [10, 8, 6, 4, 2],  # First location
...     [20, 16, 12, 8, 4]  # Second location
... ])
fdc = cal_fdc(data, quantile_num=5)
print(fdc)
array([[10.,  8.,  6.,  4.,  2.],
       [20., 16., 12.,  8.,  4.]])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_fdc</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">quantile_num</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Flow Duration Curves (FDC) for multiple time series.</span>

<span class="sd">    This function computes flow duration curves for multiple time series data,</span>
<span class="sd">    typically used for analyzing streamflow characteristics. It handles NaN</span>
<span class="sd">    values and provides a specified number of quantile points.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.array): 2D array of shape [n_grid, n_day] containing time</span>
<span class="sd">            series data for multiple locations/grids.</span>
<span class="sd">        quantile_num (int, optional): Number of quantile points to compute</span>
<span class="sd">            for each FDC. Defaults to 100.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Array of shape [n_grid, quantile_num] containing FDC</span>
<span class="sd">            values for each location/grid.</span>

<span class="sd">    Note:</span>
<span class="sd">        - Data is sorted from high to low flow</span>
<span class="sd">        - NaN values are removed before processing</span>
<span class="sd">        - Empty series are filled with zeros</span>
<span class="sd">        - Quantiles are evenly spaced from 0 to 1</span>
<span class="sd">        - Output shape is always [n_grid, quantile_num]</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception: If output flow array length doesn&#39;t match quantile_num.</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([</span>
<span class="sd">        ...     [10, 8, 6, 4, 2],  # First location</span>
<span class="sd">        ...     [20, 16, 12, 8, 4]  # Second location</span>
<span class="sd">        ... ])</span>
<span class="sd">        &gt;&gt;&gt; fdc = cal_fdc(data, quantile_num=5)</span>
<span class="sd">        &gt;&gt;&gt; print(fdc)</span>
<span class="sd">        array([[10.,  8.,  6.,  4.,  2.],</span>
<span class="sd">               [20., 16., 12.,  8.,  4.]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># data = n_grid * n_day</span>
    <span class="n">n_grid</span><span class="p">,</span> <span class="n">n_day</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">fdc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">([</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">quantile_num</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_grid</span><span class="p">):</span>
        <span class="n">temp_data0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">temp_data</span> <span class="o">=</span> <span class="n">temp_data0</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">temp_data0</span><span class="p">)]</span>
        <span class="c1"># deal with no data case for some gages</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">temp_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_day</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># sort from large to small</span>
        <span class="n">temp_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># select quantile_num quantile points</span>
        <span class="n">n_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp_data</span><span class="p">)</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">quantile_num</span><span class="p">)</span> <span class="o">/</span> <span class="n">quantile_num</span> <span class="o">*</span> <span class="n">n_len</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">fdc_flow</span> <span class="o">=</span> <span class="n">temp_sort</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">fdc_flow</span><span class="p">)</span> <span class="o">!=</span> <span class="n">quantile_num</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;unknown assimilation variable&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fdc</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">fdc_flow</span>

    <span class="k">return</span> <span class="n">fdc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate basic statistics for an array, handling NaN values.</p>
<p>This function computes four basic statistical measures (10th and 90th
percentiles, mean, and standard deviation) while properly handling NaN
values. If the array is empty after removing NaN values, a zero value
is used for calculations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input array, may contain NaN values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: Four statistical measures in order:
- p10: 10th percentile
- p90: 90th percentile
- mean: Arithmetic mean
- std: Standard deviation (minimum 0.001)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>NaN values are automatically removed before calculations</li>
<li>If all values are NaN, returns statistics for [0]</li>
<li>Uses cal_4_stat_inds for actual calculations</li>
<li>If std &lt; 0.001, it is set to 1 to avoid division issues</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([1.0, 2.0, np.nan, 4.0, 5.0])
p10, p90, mean, std = cal_stat(data)
print(f"P10: {p10}, P90: {p90}, Mean: {mean}, Std: {std}")
P10: 1.3, P90: 4.7, Mean: 3.0, Std: 1.58</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate basic statistics for an array, handling NaN values.</span>

<span class="sd">    This function computes four basic statistical measures (10th and 90th</span>
<span class="sd">    percentiles, mean, and standard deviation) while properly handling NaN</span>
<span class="sd">    values. If the array is empty after removing NaN values, a zero value</span>
<span class="sd">    is used for calculations.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.ndarray): Input array, may contain NaN values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: Four statistical measures in order:</span>
<span class="sd">            - p10: 10th percentile</span>
<span class="sd">            - p90: 90th percentile</span>
<span class="sd">            - mean: Arithmetic mean</span>
<span class="sd">            - std: Standard deviation (minimum 0.001)</span>

<span class="sd">    Note:</span>
<span class="sd">        - NaN values are automatically removed before calculations</span>
<span class="sd">        - If all values are NaN, returns statistics for [0]</span>
<span class="sd">        - Uses cal_4_stat_inds for actual calculations</span>
<span class="sd">        - If std &lt; 0.001, it is set to 1 to avoid division issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1.0, 2.0, np.nan, 4.0, 5.0])</span>
<span class="sd">        &gt;&gt;&gt; p10, p90, mean, std = cal_stat(data)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;P10: {p10}, P90: {p90}, Mean: {mean}, Std: {std}&quot;)</span>
<span class="sd">        P10: 1.3, P90: 4.7, Mean: 3.0, Std: 1.58</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
    <span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># if b is [], then give it a 0 value</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat_gamma" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat_gamma" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Transform time series data to approximate normal distribution.</p>
<p>This function applies a transformation to hydrological time series data
(streamflow, precipitation, evapotranspiration) to make it more normally
distributed. The transformation is: log10(sqrt(x) + 0.1).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series data, typically daily values of:
- Streamflow
- Precipitation
- Evapotranspiration</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: Four statistical measures of transformed data:
- p10: 10th percentile
- p90: 90th percentile
- mean: Arithmetic mean
- std: Standard deviation (minimum 0.001)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>NaN values are automatically removed before transformation</li>
<li>Transformation: log10(sqrt(x) + 0.1)</li>
<li>This transformation helps handle gamma-distributed data</li>
<li>If std &lt; 0.001, it is set to 1 to avoid division issues</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([0.0, 0.1, 1.0, 10.0, np.nan, 100.0])
p10, p90, mean, std = cal_stat_gamma(data)
print(f"P10: {p10:.2f}, P90: {p90:.2f}")
P10: -0.52, P90: 1.01</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_gamma</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Transform time series data to approximate normal distribution.</span>

<span class="sd">    This function applies a transformation to hydrological time series data</span>
<span class="sd">    (streamflow, precipitation, evapotranspiration) to make it more normally</span>
<span class="sd">    distributed. The transformation is: log10(sqrt(x) + 0.1).</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.ndarray): Time series data, typically daily values of:</span>
<span class="sd">            - Streamflow</span>
<span class="sd">            - Precipitation</span>
<span class="sd">            - Evapotranspiration</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: Four statistical measures of transformed data:</span>
<span class="sd">            - p10: 10th percentile</span>
<span class="sd">            - p90: 90th percentile</span>
<span class="sd">            - mean: Arithmetic mean</span>
<span class="sd">            - std: Standard deviation (minimum 0.001)</span>

<span class="sd">    Note:</span>
<span class="sd">        - NaN values are automatically removed before transformation</span>
<span class="sd">        - Transformation: log10(sqrt(x) + 0.1)</span>
<span class="sd">        - This transformation helps handle gamma-distributed data</span>
<span class="sd">        - If std &lt; 0.001, it is set to 1 to avoid division issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([0.0, 0.1, 1.0, 10.0, np.nan, 100.0])</span>
<span class="sd">        &gt;&gt;&gt; p10, p90, mean, std = cal_stat_gamma(data)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;P10: {p10:.2f}, P90: {p90:.2f}&quot;)</span>
<span class="sd">        P10: -0.52, P90: 1.01</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>  <span class="c1"># kick out Nan</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span>
    <span class="p">)</span>  <span class="c1"># do some tranformation to change gamma characteristics</span>
    <span class="k">return</span> <span class="n">cal_4_stat_inds</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.cal_stat_prcp_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">cal_stat_prcp_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanprep</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.cal_stat_prcp_norm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize variables by precipitation and calculate gamma statistics.</p>
<p>This function normalizes a variable (e.g., streamflow) by mean precipitation
to remove the influence of rainfall magnitude, making statistics comparable
between dry and wet basins. After normalization, gamma transformation is
applied.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data to be normalized, typically streamflow or other
hydrological variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>meanprep</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mean precipitation values for normalization.
Usually obtained from basin attributes (e.g., p_mean).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[float]: Four statistical measures of normalized data:
- p10: 10th percentile
- p90: 90th percentile
- mean: Arithmetic mean
- std: Standard deviation (minimum 0.001)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Normalization: x / meanprep (unit: mm/day / mm/day)</li>
<li>After normalization, gamma transformation is applied</li>
<li>Helps compare basins with different precipitation regimes</li>
<li>If std &lt; 0.001, it is set to 1 to avoid division issues</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([[10.0, 20.0], [30.0, 40.0]])  # 2 basins, 2 timesteps
mean_prep = np.array([100.0, 200.0])  # Mean prep for 2 basins
p10, p90, mean, std = cal_stat_prcp_norm(data, mean_prep)
print(f"P10: {p10:.3f}, P90: {p90:.3f}")
P10: -0.523, P90: -0.398</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">cal_stat_prcp_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">meanprep</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize variables by precipitation and calculate gamma statistics.</span>

<span class="sd">    This function normalizes a variable (e.g., streamflow) by mean precipitation</span>
<span class="sd">    to remove the influence of rainfall magnitude, making statistics comparable</span>
<span class="sd">    between dry and wet basins. After normalization, gamma transformation is</span>
<span class="sd">    applied.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.ndarray): Data to be normalized, typically streamflow or other</span>
<span class="sd">            hydrological variables.</span>
<span class="sd">        meanprep (np.ndarray): Mean precipitation values for normalization.</span>
<span class="sd">            Usually obtained from basin attributes (e.g., p_mean).</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[float]: Four statistical measures of normalized data:</span>
<span class="sd">            - p10: 10th percentile</span>
<span class="sd">            - p90: 90th percentile</span>
<span class="sd">            - mean: Arithmetic mean</span>
<span class="sd">            - std: Standard deviation (minimum 0.001)</span>

<span class="sd">    Note:</span>
<span class="sd">        - Normalization: x / meanprep (unit: mm/day / mm/day)</span>
<span class="sd">        - After normalization, gamma transformation is applied</span>
<span class="sd">        - Helps compare basins with different precipitation regimes</span>
<span class="sd">        - If std &lt; 0.001, it is set to 1 to avoid division issues</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([[10.0, 20.0], [30.0, 40.0]])  # 2 basins, 2 timesteps</span>
<span class="sd">        &gt;&gt;&gt; mean_prep = np.array([100.0, 200.0])  # Mean prep for 2 basins</span>
<span class="sd">        &gt;&gt;&gt; p10, p90, mean, std = cal_stat_prcp_norm(data, mean_prep)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;P10: {p10:.3f}, P90: {p90:.3f}&quot;)</span>
<span class="sd">        P10: -0.523, P90: -0.398</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># meanprep = readAttr(gageDict[&#39;id&#39;], [&#39;q_mean&#39;])</span>
    <span class="n">tempprep</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">meanprep</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># unit (mm/day)/(mm/day)</span>
    <span class="n">flowua</span> <span class="o">=</span> <span class="n">x</span> <span class="o">/</span> <span class="n">tempprep</span>
    <span class="k">return</span> <span class="n">cal_stat_gamma</span><span class="p">(</span><span class="n">flowua</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.ecdf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.ecdf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute Empirical Cumulative Distribution Function (ECDF).</p>
<p>This function calculates the empirical CDF for a given dataset. The ECDF
shows the fraction of observations less than or equal to each data point.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="numpy.ndarray">ndarray</span>, <span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[np.ndarray, np.ndarray]: Two arrays:
- x: Sorted input data
- y: Cumulative probabilities (0 to 1)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Data is sorted in ascending order</li>
<li>Probabilities are calculated as (i)/(n) for i=1..n</li>
<li>No special handling of NaN values - remove them before calling</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([1, 2, 2, 3, 3, 3, 4, 4, 5])
x, y = ecdf(data)
print("Values:", x)
Values: [1 2 2 3 3 3 4 4 5]
print("Probabilities:", y)
Probabilities: [0.111 0.222 0.333 0.444 0.556 0.667 0.778 0.889 1.000]</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute Empirical Cumulative Distribution Function (ECDF).</span>

<span class="sd">    This function calculates the empirical CDF for a given dataset. The ECDF</span>
<span class="sd">    shows the fraction of observations less than or equal to each data point.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.ndarray): Input data array.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[np.ndarray, np.ndarray]: Two arrays:</span>
<span class="sd">            - x: Sorted input data</span>
<span class="sd">            - y: Cumulative probabilities (0 to 1)</span>

<span class="sd">    Note:</span>
<span class="sd">        - Data is sorted in ascending order</span>
<span class="sd">        - Probabilities are calculated as (i)/(n) for i=1..n</span>
<span class="sd">        - No special handling of NaN values - remove them before calling</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 2, 2, 3, 3, 3, 4, 4, 5])</span>
<span class="sd">        &gt;&gt;&gt; x, y = ecdf(data)</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Values:&quot;, x)</span>
<span class="sd">        Values: [1 2 2 3 3 3 4 4 5]</span>
<span class="sd">        &gt;&gt;&gt; print(&quot;Probabilities:&quot;, y)</span>
<span class="sd">        Probabilities: [0.111 0.222 0.333 0.444 0.556 0.667 0.778 0.889 1.000]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.flood_peak_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flood_peak_error</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">,</span> <span class="n">Q_sim</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.flood_peak_error" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate relative flood peak error.</p>
<h4 id="hydroutils.hydro_stat.flood_peak_error--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.flood_peak_error--parameters" title="Permanent link">&para;</a></h4>
<p>Q_obs : array-like
    Observed streamflow.
Q_sim : array-like
    Simulated streamflow.</p>
<h4 id="hydroutils.hydro_stat.flood_peak_error--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.flood_peak_error--returns" title="Permanent link">&para;</a></h4>
<p>float
    Relative flood peak error (%).</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flood_peak_error</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">,</span> <span class="n">Q_sim</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate relative flood peak error.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q_obs : array-like</span>
<span class="sd">        Observed streamflow.</span>
<span class="sd">    Q_sim : array-like</span>
<span class="sd">        Simulated streamflow.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Relative flood peak error (%).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">peak_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">)</span>
    <span class="n">peak_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Q_sim</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">peak_obs</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">peak_sim</span> <span class="o">-</span> <span class="n">peak_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">peak_obs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.flood_peak_timing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flood_peak_timing</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">,</span> <span class="n">datetime_coord</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.flood_peak_timing" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate mean difference in peak flow timing (simplified version for numpy arrays).</p>
<p>Uses scipy.find_peaks to find peaks in the observed time series. Starting with all observed peaks, those with a
prominence of less than the standard deviation of the observed time series are discarded. Next, the lowest peaks
are subsequently discarded until all remaining peaks have a distance of at least 100 steps. Finally, the
corresponding peaks in the simulated time series are searched in a window of size <code>window</code> on either side of the
observed peaks and the absolute time differences between observed and simulated peaks is calculated.
The final metric is the mean absolute time difference across all peaks (in time steps).</p>
<h4 id="hydroutils.hydro_stat.flood_peak_timing--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.flood_peak_timing--parameters" title="Permanent link">&para;</a></h4>
<p>obs : np.ndarray
    Observed time series.
sim : np.ndarray
    Simulated time series.
window : int, optional
    Size of window to consider on each side of the observed peak for finding the simulated peak. That is, the total
    window length to find the peak in the simulations is 2 * window + 1 centered at the observed
    peak. The default depends on the temporal resolution, e.g. for a resolution of '1D', a window of 3 is used and
    for a resolution of '1H' the window size is 12.
resolution : str, optional
    Temporal resolution of the time series in pandas format, e.g. '1D' for daily and '1H' for hourly.
    Currently used only for determining default window size.
datetime_coord : str, optional
    Name of datetime coordinate. Currently unused in this simplified implementation.</p>
<h4 id="hydroutils.hydro_stat.flood_peak_timing--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.flood_peak_timing--returns" title="Permanent link">&para;</a></h4>
<p>float
    Mean peak time difference in time steps. Returns NaN if no peaks are found.</p>
<h4 id="hydroutils.hydro_stat.flood_peak_timing--references">References<a class="headerlink" href="#hydroutils.hydro_stat.flood_peak_timing--references" title="Permanent link">&para;</a></h4>
<p>.. [#] Kratzert, F., Klotz, D., Hochreiter, S., and Nearing, G. S.: A note on leveraging synergy in multiple
    meteorological datasets with deep learning for rainfall-runoff modeling, Hydrol. Earth Syst. Sci.,
    https://doi.org/10.5194/hess-2020-221</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flood_peak_timing</span><span class="p">(</span>
    <span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">sim</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">window</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;1D&quot;</span><span class="p">,</span>
    <span class="n">datetime_coord</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate mean difference in peak flow timing (simplified version for numpy arrays).</span>

<span class="sd">    Uses scipy.find_peaks to find peaks in the observed time series. Starting with all observed peaks, those with a</span>
<span class="sd">    prominence of less than the standard deviation of the observed time series are discarded. Next, the lowest peaks</span>
<span class="sd">    are subsequently discarded until all remaining peaks have a distance of at least 100 steps. Finally, the</span>
<span class="sd">    corresponding peaks in the simulated time series are searched in a window of size `window` on either side of the</span>
<span class="sd">    observed peaks and the absolute time differences between observed and simulated peaks is calculated.</span>
<span class="sd">    The final metric is the mean absolute time difference across all peaks (in time steps).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : np.ndarray</span>
<span class="sd">        Observed time series.</span>
<span class="sd">    sim : np.ndarray</span>
<span class="sd">        Simulated time series.</span>
<span class="sd">    window : int, optional</span>
<span class="sd">        Size of window to consider on each side of the observed peak for finding the simulated peak. That is, the total</span>
<span class="sd">        window length to find the peak in the simulations is 2 * window + 1 centered at the observed</span>
<span class="sd">        peak. The default depends on the temporal resolution, e.g. for a resolution of &#39;1D&#39;, a window of 3 is used and</span>
<span class="sd">        for a resolution of &#39;1H&#39; the window size is 12.</span>
<span class="sd">    resolution : str, optional</span>
<span class="sd">        Temporal resolution of the time series in pandas format, e.g. &#39;1D&#39; for daily and &#39;1H&#39; for hourly.</span>
<span class="sd">        Currently used only for determining default window size.</span>
<span class="sd">    datetime_coord : str, optional</span>
<span class="sd">        Name of datetime coordinate. Currently unused in this simplified implementation.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Mean peak time difference in time steps. Returns NaN if no peaks are found.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#] Kratzert, F., Klotz, D., Hochreiter, S., and Nearing, G. S.: A note on leveraging synergy in multiple</span>
<span class="sd">        meteorological datasets with deep learning for rainfall-runoff modeling, Hydrol. Earth Syst. Sci.,</span>
<span class="sd">        https://doi.org/10.5194/hess-2020-221</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># verify inputs</span>
    <span class="n">_validate_inputs</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>

    <span class="c1"># get time series with only valid observations (scipy&#39;s find_peaks doesn&#39;t guarantee correctness with NaNs)</span>
    <span class="n">obs_clean</span><span class="p">,</span> <span class="n">sim_clean</span> <span class="o">=</span> <span class="n">_mask_valid</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_clean</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># determine default window size based on resolution</span>
    <span class="k">if</span> <span class="n">window</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># infer a reasonable window size based on resolution</span>
        <span class="n">window</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">_get_frequency_factor</span><span class="p">(</span><span class="s2">&quot;12H&quot;</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)),</span> <span class="mi">3</span><span class="p">)</span>

    <span class="c1"># heuristic to get indices of peaks and their corresponding height.</span>
    <span class="c1"># Use prominence based on standard deviation to filter significant peaks</span>
    <span class="n">prominence_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">obs_clean</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">prominence_threshold</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Handle constant time series</span>
        <span class="n">prominence_threshold</span> <span class="o">=</span> <span class="p">(</span>
            <span class="mf">0.01</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs_clean</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">obs_clean</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.01</span>
        <span class="p">)</span>

    <span class="n">peaks</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">find_peaks</span><span class="p">(</span>
        <span class="n">obs_clean</span><span class="p">,</span> <span class="n">distance</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">prominence</span><span class="o">=</span><span class="n">prominence_threshold</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">peaks</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># evaluate timing</span>
    <span class="n">timing_errors</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">peaks</span><span class="p">:</span>
        <span class="c1"># skip peaks at the start and end of the sequence</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="n">window</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">idx</span> <span class="o">+</span> <span class="n">window</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_clean</span><span class="p">)):</span>
            <span class="k">continue</span>

        <span class="c1"># find the corresponding peak in simulated data within the window</span>
        <span class="n">window_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">idx</span> <span class="o">-</span> <span class="n">window</span><span class="p">)</span>
        <span class="n">window_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sim_clean</span><span class="p">),</span> <span class="n">idx</span> <span class="o">+</span> <span class="n">window</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">sim_window</span> <span class="o">=</span> <span class="n">sim_clean</span><span class="p">[</span><span class="n">window_start</span><span class="p">:</span><span class="n">window_end</span><span class="p">]</span>

        <span class="c1"># find the index of maximum value in the window</span>
        <span class="n">local_peak_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">sim_window</span><span class="p">)</span>
        <span class="n">global_peak_idx</span> <span class="o">=</span> <span class="n">window_start</span> <span class="o">+</span> <span class="n">local_peak_idx</span>

        <span class="c1"># calculate the time difference between the peaks (in time steps)</span>
        <span class="n">timing_error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="n">global_peak_idx</span><span class="p">)</span>
        <span class="n">timing_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">timing_error</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">timing_errors</span><span class="p">)</span> <span class="k">if</span> <span class="n">timing_errors</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.flood_volume_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">flood_volume_error</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">,</span> <span class="n">Q_sim</span><span class="p">,</span> <span class="n">delta_t_seconds</span><span class="o">=</span><span class="mi">10800</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.flood_volume_error" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate relative flood volume error.</p>
<h4 id="hydroutils.hydro_stat.flood_volume_error--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.flood_volume_error--parameters" title="Permanent link">&para;</a></h4>
<p>Q_obs : array-like
    Observed streamflow.
Q_sim : array-like
    Simulated streamflow.
delta_t_seconds : int, optional
    Time step in seconds, by default 10800 (3 hours).</p>
<h4 id="hydroutils.hydro_stat.flood_volume_error--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.flood_volume_error--returns" title="Permanent link">&para;</a></h4>
<p>float
    Relative flood volume error (%).</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">flood_volume_error</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">,</span> <span class="n">Q_sim</span><span class="p">,</span> <span class="n">delta_t_seconds</span><span class="o">=</span><span class="mi">10800</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate relative flood volume error.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Q_obs : array-like</span>
<span class="sd">        Observed streamflow.</span>
<span class="sd">    Q_sim : array-like</span>
<span class="sd">        Simulated streamflow.</span>
<span class="sd">    delta_t_seconds : int, optional</span>
<span class="sd">        Time step in seconds, by default 10800 (3 hours).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Relative flood volume error (%).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vol_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_obs</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_t_seconds</span>
    <span class="n">vol_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">Q_sim</span><span class="p">)</span> <span class="o">*</span> <span class="n">delta_t_seconds</span>

    <span class="k">if</span> <span class="n">vol_obs</span> <span class="o">&gt;</span> <span class="mf">1e-6</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">((</span><span class="n">vol_sim</span> <span class="o">-</span> <span class="n">vol_obs</span><span class="p">)</span> <span class="o">/</span> <span class="n">vol_obs</span><span class="p">)</span> <span class="o">*</span> <span class="mf">100.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.fms" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fms</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">sim</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.fms" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>TODO: not fully tested
Calculate the slope of the middle section of the flow duration curve [#]_</p>
<p>.. math::
    \%\text{BiasFMS} = \frac{\left | \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right | -
        \left | \log(Q_{o,\text{lower}}) - \log(Q_{o,\text{upper}}) \right |}{\left |
        \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right |} \times 100,</p>
<p>where :math:<code>Q_{s,\text{lower/upper}}</code> corresponds to the FDC of the simulations (here, <code>sim</code>) at the <code>lower</code> and
<code>upper</code> bound of the middle section and :math:<code>Q_{o,\text{lower/upper}}</code> similarly for the observations (here,
<code>obs</code>).</p>
<h4 id="hydroutils.hydro_stat.fms--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.fms--parameters" title="Permanent link">&para;</a></h4>
<p>obs : DataArray
    Observed time series.
sim : DataArray
    Simulated time series.
lower : float, optional
    Lower bound of the middle section in range ]0,1[, by default 0.2
upper : float, optional
    Upper bound of the middle section in range ]0,1[, by default 0.7</p>
<h4 id="hydroutils.hydro_stat.fms--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.fms--returns" title="Permanent link">&para;</a></h4>
<p>float
    Slope of the middle section of the flow duration curve.</p>
<h4 id="hydroutils.hydro_stat.fms--references">References<a class="headerlink" href="#hydroutils.hydro_stat.fms--references" title="Permanent link">&para;</a></h4>
<p>.. [#] Yilmaz, K. K., Gupta, H. V., and Wagener, T. ( 2008), A process-based diagnostic approach to model
    evaluation: Application to the NWS distributed hydrologic model, Water Resour. Res., 44, W09417,
    doi:10.1029/2007WR006716.</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fms</span><span class="p">(</span>
    <span class="n">obs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">sim</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">lower</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">upper</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    TODO: not fully tested</span>
<span class="sd">    Calculate the slope of the middle section of the flow duration curve [#]_</span>

<span class="sd">    .. math::</span>
<span class="sd">        \%\text{BiasFMS} = \frac{\left | \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right | -</span>
<span class="sd">            \left | \log(Q_{o,\text{lower}}) - \log(Q_{o,\text{upper}}) \right |}{\left |</span>
<span class="sd">            \log(Q_{s,\text{lower}}) - \log(Q_{s,\text{upper}}) \right |} \times 100,</span>

<span class="sd">    where :math:`Q_{s,\text{lower/upper}}` corresponds to the FDC of the simulations (here, `sim`) at the `lower` and</span>
<span class="sd">    `upper` bound of the middle section and :math:`Q_{o,\text{lower/upper}}` similarly for the observations (here,</span>
<span class="sd">    `obs`).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    obs : DataArray</span>
<span class="sd">        Observed time series.</span>
<span class="sd">    sim : DataArray</span>
<span class="sd">        Simulated time series.</span>
<span class="sd">    lower : float, optional</span>
<span class="sd">        Lower bound of the middle section in range ]0,1[, by default 0.2</span>
<span class="sd">    upper : float, optional</span>
<span class="sd">        Upper bound of the middle section in range ]0,1[, by default 0.7</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Slope of the middle section of the flow duration curve.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [#] Yilmaz, K. K., Gupta, H. V., and Wagener, T. ( 2008), A process-based diagnostic approach to model</span>
<span class="sd">        evaluation: Application to the NWS distributed hydrologic model, Water Resour. Res., 44, W09417,</span>
<span class="sd">        doi:10.1029/2007WR006716.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="nb">any</span><span class="p">((</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">upper</span><span class="p">,</span> <span class="n">lower</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;upper and lower have to be in range ]0,1[&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">lower</span> <span class="o">&gt;=</span> <span class="n">upper</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The lower threshold has to be smaller than the upper.&quot;</span><span class="p">)</span>

    <span class="c1"># get arrays of sorted (descending) discharges</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    <span class="n">sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">sim</span><span class="p">)</span>

    <span class="c1"># for numerical reasons change 0s to 1e-6. Simulations can still contain negatives, so also reset those.</span>
    <span class="n">sim</span><span class="p">[</span><span class="n">sim</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="n">obs</span><span class="p">[</span><span class="n">obs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1e-6</span>

    <span class="c1"># calculate fms part by part</span>
    <span class="n">qsm_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lower</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qsm_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sim</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sim</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qom_lower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lower</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>
    <span class="n">qom_upper</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">obs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">upper</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)])</span>

    <span class="n">fms</span> <span class="o">=</span> <span class="p">((</span><span class="n">qsm_lower</span> <span class="o">-</span> <span class="n">qsm_upper</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">qom_lower</span> <span class="o">-</span> <span class="n">qom_upper</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
        <span class="n">qom_lower</span> <span class="o">-</span> <span class="n">qom_upper</span> <span class="o">+</span> <span class="mf">1e-6</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">fms</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.month_stat_for_daily_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">month_stat_for_daily_df</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.month_stat_for_daily_df" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate monthly statistics from daily data.</p>
<p>This function resamples daily data to monthly frequency by computing the
mean value for each month. It ensures the input DataFrame has a datetime
index before resampling.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing daily data with datetime index
or index that can be converted to datetime.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame containing monthly statistics (means).
Index is the start of each month.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Uses pandas resample with 'MS' (month start) frequency</li>
<li>Automatically converts index to datetime if needed</li>
<li>Computes mean value for each month</li>
<li>Handles missing values according to pandas defaults</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>dates = pd.date_range('2020-01-01', '2020-12-31', freq='D')
data = pd.DataFrame({'value': range(366)}, index=dates)
monthly = month_stat_for_daily_df(data)
print(monthly.head())
               value
2020-01-01  15.0
2020-02-01  45.5
2020-03-01  74.0
2020-04-01  105.0
2020-05-01  135.5</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">month_stat_for_daily_df</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate monthly statistics from daily data.</span>

<span class="sd">    This function resamples daily data to monthly frequency by computing the</span>
<span class="sd">    mean value for each month. It ensures the input DataFrame has a datetime</span>
<span class="sd">    index before resampling.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame containing daily data with datetime index</span>
<span class="sd">            or index that can be converted to datetime.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame containing monthly statistics (means).</span>
<span class="sd">            Index is the start of each month.</span>

<span class="sd">    Note:</span>
<span class="sd">        - Uses pandas resample with &#39;MS&#39; (month start) frequency</span>
<span class="sd">        - Automatically converts index to datetime if needed</span>
<span class="sd">        - Computes mean value for each month</span>
<span class="sd">        - Handles missing values according to pandas defaults</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; dates = pd.date_range(&#39;2020-01-01&#39;, &#39;2020-12-31&#39;, freq=&#39;D&#39;)</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({&#39;value&#39;: range(366)}, index=dates)</span>
<span class="sd">        &gt;&gt;&gt; monthly = month_stat_for_daily_df(data)</span>
<span class="sd">        &gt;&gt;&gt; print(monthly.head())</span>
<span class="sd">                       value</span>
<span class="sd">        2020-01-01  15.0</span>
<span class="sd">        2020-02-01  45.5</span>
<span class="sd">        2020-03-01  74.0</span>
<span class="sd">        2020-04-01  105.0</span>
<span class="sd">        2020-05-01  135.5</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># guarantee the index is datetime</span>
    <span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.pbias" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pbias</span><span class="p">(</span><span class="n">observed</span><span class="p">,</span> <span class="n">simulated</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.pbias" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate Percent Bias (PBIAS)</p>
<h4 id="hydroutils.hydro_stat.pbias--parameters">Parameters<a class="headerlink" href="#hydroutils.hydro_stat.pbias--parameters" title="Permanent link">&para;</a></h4>
<p>observed : array-like
    Observed values
simulated : array-like
    Simulated values</p>
<h4 id="hydroutils.hydro_stat.pbias--returns">Returns<a class="headerlink" href="#hydroutils.hydro_stat.pbias--returns" title="Permanent link">&para;</a></h4>
<p>float
    Percent bias value</p>


            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">pbias</span><span class="p">(</span>
    <span class="n">observed</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">simulated</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate Percent Bias (PBIAS)</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    observed : array-like</span>
<span class="sd">        Observed values</span>
<span class="sd">    simulated : array-like</span>
<span class="sd">        Simulated values</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    float</span>
<span class="sd">        Percent bias value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">simulated</span><span class="p">)</span>

    <span class="c1"># Remove NaN values</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">simulated</span><span class="p">))</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">observed</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="n">simulated</span> <span class="o">=</span> <span class="n">simulated</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">simulated</span> <span class="o">-</span> <span class="n">observed</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">observed</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.remove_abnormal_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_abnormal_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mf">1e-05</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mf">0.99999</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.remove_abnormal_data" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Remove extreme values from data using quantile thresholds.</p>
<p>This function removes data points that fall outside specified quantile
ranges by replacing them with NaN values. This is useful for removing
outliers or extreme values that might affect analysis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data array.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q1</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Lower quantile threshold. Values below this
quantile will be replaced with NaN. Defaults to 0.00001.</p>
              </div>
            </td>
            <td>
                  <code>1e-05</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q2</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Upper quantile threshold. Values above this
quantile will be replaced with NaN. Defaults to 0.99999.</p>
              </div>
            </td>
            <td>
                  <code>0.99999</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Data array with extreme values replaced by NaN.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Uses numpy.quantile for threshold calculation</li>
<li>Values equal to thresholds are kept</li>
<li>Original array shape is preserved</li>
<li>NaN values in input are preserved</li>
<li>Default thresholds keep 99.998% of data</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>data = np.array([1, 2, 3, 100, 4, 5, 0.001, 6])
cleaned = remove_abnormal_data(data, q1=0.1, q2=0.9)
print(cleaned)
array([nan,  2.,  3.,  nan,  4.,  5.,  nan,  6.])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_abnormal_data</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">q1</span><span class="o">=</span><span class="mf">0.00001</span><span class="p">,</span> <span class="n">q2</span><span class="o">=</span><span class="mf">0.99999</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove extreme values from data using quantile thresholds.</span>

<span class="sd">    This function removes data points that fall outside specified quantile</span>
<span class="sd">    ranges by replacing them with NaN values. This is useful for removing</span>
<span class="sd">    outliers or extreme values that might affect analysis.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (np.ndarray): Input data array.</span>
<span class="sd">        q1 (float, optional): Lower quantile threshold. Values below this</span>
<span class="sd">            quantile will be replaced with NaN. Defaults to 0.00001.</span>
<span class="sd">        q2 (float, optional): Upper quantile threshold. Values above this</span>
<span class="sd">            quantile will be replaced with NaN. Defaults to 0.99999.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Data array with extreme values replaced by NaN.</span>

<span class="sd">    Note:</span>
<span class="sd">        - Uses numpy.quantile for threshold calculation</span>
<span class="sd">        - Values equal to thresholds are kept</span>
<span class="sd">        - Original array shape is preserved</span>
<span class="sd">        - NaN values in input are preserved</span>
<span class="sd">        - Default thresholds keep 99.998% of data</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([1, 2, 3, 100, 4, 5, 0.001, 6])</span>
<span class="sd">        &gt;&gt;&gt; cleaned = remove_abnormal_data(data, q1=0.1, q2=0.9)</span>
<span class="sd">        &gt;&gt;&gt; print(cleaned)</span>
<span class="sd">        array([nan,  2.,  3.,  nan,  4.,  5.,  nan,  6.])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># remove abnormal data</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">q1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">data</span><span class="p">[</span><span class="n">data</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">q2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_error" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">fill_nan</span><span class="o">=</span><span class="s1">&#39;no&#39;</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_error" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate statistical metrics for 2D arrays with NaN handling options.</p>
<p>This function computes multiple statistical metrics comparing predicted values
against target (observed) values for multiple time series (e.g., multiple
basins). It provides different options for handling NaN values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target (observed) values. 2D array [basin, sequence].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predicted values. Same shape as target.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_nan</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Method for handling NaN values. Options:
- "no": Ignore NaN values (default)
- "sum": Sum values in NaN locations
- "mean": Average values in NaN locations</p>
              </div>
            </td>
            <td>
                  <code>&#39;no&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>], <span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="float">float</span>]]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Union[Dict[str, np.ndarray], Dict[str, List[float]]]: Dictionary with metrics:
- Bias: Mean error
- RMSE: Root mean square error
- ubRMSE: Unbiased root mean square error
- Corr: Pearson correlation coefficient
- R2: Coefficient of determination
- NSE: Nash-Sutcliffe efficiency
- KGE: Kling-Gupta efficiency
- FHV: Peak flow bias (top 2%)
- FLV: Low flow bias (bottom 30%)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If input arrays have wrong dimensions or incompatible shapes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <p>For fill_nan options:
- "no": [1, nan, nan, 2] vs [0.3, 0.3, 0.3, 1.5] becomes [1, 2] vs [0.3, 1.5]
- "sum": [1, nan, nan, 2] vs [0.3, 0.3, 0.3, 1.5] becomes [1, 2] vs [0.9, 1.5]
- "mean": Similar to "sum" but takes average instead of sum</p>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>target = np.array([[1.0, np.nan, np.nan, 2.0],
...                    [3.0, 4.0, np.nan, 6.0]])
pred = np.array([[1.1, 0.3, 0.3, 1.9],
...                  [3.2, 3.8, 0.5, 5.8]])
metrics = stat_error(target, pred, fill_nan="sum")
print(metrics['RMSE'])  # Example output
array([0.158, 0.245])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_error</span><span class="p">(</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;no&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate statistical metrics for 2D arrays with NaN handling options.</span>

<span class="sd">    This function computes multiple statistical metrics comparing predicted values</span>
<span class="sd">    against target (observed) values for multiple time series (e.g., multiple</span>
<span class="sd">    basins). It provides different options for handling NaN values.</span>

<span class="sd">    Args:</span>
<span class="sd">        target (np.ndarray): Target (observed) values. 2D array [basin, sequence].</span>
<span class="sd">        pred (np.ndarray): Predicted values. Same shape as target.</span>
<span class="sd">        fill_nan (str, optional): Method for handling NaN values. Options:</span>
<span class="sd">            - &quot;no&quot;: Ignore NaN values (default)</span>
<span class="sd">            - &quot;sum&quot;: Sum values in NaN locations</span>
<span class="sd">            - &quot;mean&quot;: Average values in NaN locations</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[Dict[str, np.ndarray], Dict[str, List[float]]]: Dictionary with metrics:</span>
<span class="sd">            - Bias: Mean error</span>
<span class="sd">            - RMSE: Root mean square error</span>
<span class="sd">            - ubRMSE: Unbiased root mean square error</span>
<span class="sd">            - Corr: Pearson correlation coefficient</span>
<span class="sd">            - R2: Coefficient of determination</span>
<span class="sd">            - NSE: Nash-Sutcliffe efficiency</span>
<span class="sd">            - KGE: Kling-Gupta efficiency</span>
<span class="sd">            - FHV: Peak flow bias (top 2%)</span>
<span class="sd">            - FLV: Low flow bias (bottom 30%)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If input arrays have wrong dimensions or incompatible shapes.</span>

<span class="sd">    Note:</span>
<span class="sd">        For fill_nan options:</span>
<span class="sd">        - &quot;no&quot;: [1, nan, nan, 2] vs [0.3, 0.3, 0.3, 1.5] becomes [1, 2] vs [0.3, 1.5]</span>
<span class="sd">        - &quot;sum&quot;: [1, nan, nan, 2] vs [0.3, 0.3, 0.3, 1.5] becomes [1, 2] vs [0.9, 1.5]</span>
<span class="sd">        - &quot;mean&quot;: Similar to &quot;sum&quot; but takes average instead of sum</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; target = np.array([[1.0, np.nan, np.nan, 2.0],</span>
<span class="sd">        ...                    [3.0, 4.0, np.nan, 6.0]])</span>
<span class="sd">        &gt;&gt;&gt; pred = np.array([[1.1, 0.3, 0.3, 1.9],</span>
<span class="sd">        ...                  [3.2, 3.8, 0.5, 5.8]])</span>
<span class="sd">        &gt;&gt;&gt; metrics = stat_error(target, pred, fill_nan=&quot;sum&quot;)</span>
<span class="sd">        &gt;&gt;&gt; print(metrics[&#39;RMSE&#39;])  # Example output</span>
<span class="sd">        array([0.158, 0.245])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The input data should be 2-dim, not 3-dim. If you want to calculate metrics for 3-d arrays, please use stat_errors function.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;fill_nan should be a string.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The shape of target and pred should be the same.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="o">!=</span> <span class="s2">&quot;no&quot;</span><span class="p">:</span>
        <span class="n">each_non_nan_idx</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_non_nan_idx</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">non_nan_idx_tmp</span> <span class="o">=</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">j</span><span class="p">])]</span>
            <span class="n">each_non_nan_idx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">non_nan_idx_tmp</span><span class="p">)</span>
            <span class="c1"># TODO: now all_non_nan_idx is only set for ET, because of its irregular nan values</span>
            <span class="n">all_non_nan_idx</span> <span class="o">=</span> <span class="n">all_non_nan_idx</span> <span class="o">+</span> <span class="n">non_nan_idx_tmp</span>
            <span class="n">non_nan_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">all_non_nan_idx</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="c1"># some NaN data appear in different dates in different basins, so we have to calculate the metric for each basin</span>
        <span class="c1"># but for ET, it is not very resonable to calculate the metric for each basin in this way, for example,</span>
        <span class="c1"># the non_nan_idx: [1, 9, 17, 33, 41], then there are 16 elements in 17 -&gt; 33, so use all_non_nan_idx is better</span>
        <span class="c1"># hence we don&#39;t use each_non_nan_idx finally</span>
        <span class="n">out_dict</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">Bias</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">RMSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">ubRMSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">Corr</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">R2</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">NSE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">KGE</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">FHV</span><span class="o">=</span><span class="p">[],</span>
            <span class="n">FLV</span><span class="o">=</span><span class="p">[],</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># non_nan_idx = each_non_nan_idx[i]</span>
            <span class="n">targ_i</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>
            <span class="n">pred_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="n">dict_i</span> <span class="o">=</span> <span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out_dict</span>
    <span class="k">elif</span> <span class="n">fill_nan</span> <span class="o">==</span> <span class="s2">&quot;mean&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="c1"># non_nan_idx = each_non_nan_idx[i]</span>
            <span class="n">targ_i</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">[</span><span class="n">non_nan_idx</span><span class="p">]</span>
            <span class="n">pred_i_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="o">.</span><span class="n">reduceat</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">non_nan_idx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
                <span class="n">idx4mean</span> <span class="o">=</span> <span class="n">non_nan_idx</span> <span class="o">+</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">pred</span><span class="p">[</span><span class="n">i</span><span class="p">])]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">idx4mean</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">non_nan_idx</span><span class="p">)</span>
            <span class="n">idx_interval</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span> <span class="o">-</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx4mean</span><span class="p">,</span> <span class="n">idx4mean</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
            <span class="n">pred_i</span> <span class="o">=</span> <span class="n">pred_i_sum</span> <span class="o">/</span> <span class="n">idx_interval</span>
            <span class="n">dict_i</span> <span class="o">=</span> <span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Bias&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;RMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;ubRMSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;Corr&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;NSE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;KGE&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FHV&quot;</span><span class="p">])</span>
            <span class="n">out_dict</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dict_i</span><span class="p">[</span><span class="s2">&quot;FLV&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">out_dict</span>
    <span class="n">ngrid</span><span class="p">,</span> <span class="n">nt</span> <span class="o">=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span>
    <span class="c1"># Bias</span>
    <span class="n">Bias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">pred</span> <span class="o">-</span> <span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># RMSE</span>
    <span class="n">RMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">pred</span> <span class="o">-</span> <span class="n">target</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># ubRMSE</span>
    <span class="n">predMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">pred</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">targetMean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">nt</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">predAnom</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">predMean</span>
    <span class="n">targetAnom</span> <span class="o">=</span> <span class="n">target</span> <span class="o">-</span> <span class="n">targetMean</span>
    <span class="n">ubRMSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">predAnom</span> <span class="o">-</span> <span class="n">targetAnom</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="c1"># rho R2 NSE</span>
    <span class="n">Corr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">NSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">KGe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBiaslow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBiashigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">PBias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">ngrid</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">num_lowtarget_zero</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ngrid</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">pred</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">target</span><span class="p">[</span><span class="n">k</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
            <span class="c1"># percent bias</span>
            <span class="n">PBias</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yy</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Theoretically at least two points for correlation</span>
                <span class="n">Corr</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">pearsonr</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">yymean</span> <span class="o">=</span> <span class="n">yy</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
                <span class="n">SST</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yy</span> <span class="o">-</span> <span class="n">yymean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">SSReg</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yymean</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">SSRes</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">yy</span> <span class="o">-</span> <span class="n">xx</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">R2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSRes</span> <span class="o">/</span> <span class="n">SST</span>
                <span class="n">NSE</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">SSRes</span> <span class="o">/</span> <span class="n">SST</span>
                <span class="n">KGe</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">KGE</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
            <span class="c1"># FHV the peak flows bias 2%</span>
            <span class="c1"># FLV the low flows bias bottom 30%, log space</span>
            <span class="n">pred_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
            <span class="n">target_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
            <span class="n">indexlow</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
            <span class="n">indexhigh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
            <span class="n">lowpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
            <span class="n">highpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
            <span class="n">lowtarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
            <span class="n">hightarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">num_lowtarget_zero</span> <span class="o">=</span> <span class="n">num_lowtarget_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="c1"># Sometimes the lowtarget is all 0, which will cause a warning</span>
                <span class="c1"># but I know it is not an error, so I ignore it</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>
                <span class="n">PBiaslow</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowpred</span> <span class="o">-</span> <span class="n">lowtarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
            <span class="n">PBiashigh</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">highpred</span> <span class="o">-</span> <span class="n">hightarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hightarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">outDict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="n">Bias</span><span class="o">=</span><span class="n">Bias</span><span class="p">,</span>
        <span class="n">RMSE</span><span class="o">=</span><span class="n">RMSE</span><span class="p">,</span>
        <span class="n">ubRMSE</span><span class="o">=</span><span class="n">ubRMSE</span><span class="p">,</span>
        <span class="n">Corr</span><span class="o">=</span><span class="n">Corr</span><span class="p">,</span>
        <span class="n">R2</span><span class="o">=</span><span class="n">R2</span><span class="p">,</span>
        <span class="n">NSE</span><span class="o">=</span><span class="n">NSE</span><span class="p">,</span>
        <span class="n">KGE</span><span class="o">=</span><span class="n">KGe</span><span class="p">,</span>
        <span class="n">FHV</span><span class="o">=</span><span class="n">PBiashigh</span><span class="p">,</span>
        <span class="n">FLV</span><span class="o">=</span><span class="n">PBiaslow</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># &quot;The CDF of BFLV will not reach 1.0 because some basins have all zero flow observations for the &quot;</span>
    <span class="c1"># &quot;30% low flow interval, the percent bias can be infinite\n&quot;</span>
    <span class="c1"># &quot;The number of these cases is &quot; + str(num_lowtarget_zero)</span>
    <span class="k">return</span> <span class="n">outDict</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_error_i" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_error_i" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate multiple statistical metrics for one-dimensional arrays.</p>
<p>This function computes a comprehensive set of statistical metrics comparing
predicted values against target (observed) values. It handles NaN values
and requires at least two valid data points for correlation-based metrics.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>targ_i</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target (observed) values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred_i</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predicted values.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dict[str, float]: Dictionary containing the following metrics:
- Bias: Mean error
- RMSE: Root mean square error
- ubRMSE: Unbiased root mean square error
- Corr: Pearson correlation coefficient
- R2: Coefficient of determination
- NSE: Nash-Sutcliffe efficiency
- KGE: Kling-Gupta efficiency
- FHV: Peak flow bias (top 2%)
- FLV: Low flow bias (bottom 30%)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If there are fewer than 2 valid data points for correlation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>NaN values are automatically handled (removed from calculations)</li>
<li>FHV and FLV are calculated in percentage</li>
<li>All metrics are calculated on valid (non-NaN) data points only</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>target = np.array([1.0, 2.0, 3.0, np.nan, 5.0])
predicted = np.array([1.1, 2.2, 2.9, np.nan, 4.8])
metrics = stat_error_i(target, predicted)
print(metrics['RMSE'])  # Example output
0.173</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_error_i</span><span class="p">(</span><span class="n">targ_i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred_i</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate multiple statistical metrics for one-dimensional arrays.</span>

<span class="sd">    This function computes a comprehensive set of statistical metrics comparing</span>
<span class="sd">    predicted values against target (observed) values. It handles NaN values</span>
<span class="sd">    and requires at least two valid data points for correlation-based metrics.</span>

<span class="sd">    Args:</span>
<span class="sd">        targ_i (np.ndarray): Target (observed) values.</span>
<span class="sd">        pred_i (np.ndarray): Predicted values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Dict[str, float]: Dictionary containing the following metrics:</span>
<span class="sd">            - Bias: Mean error</span>
<span class="sd">            - RMSE: Root mean square error</span>
<span class="sd">            - ubRMSE: Unbiased root mean square error</span>
<span class="sd">            - Corr: Pearson correlation coefficient</span>
<span class="sd">            - R2: Coefficient of determination</span>
<span class="sd">            - NSE: Nash-Sutcliffe efficiency</span>
<span class="sd">            - KGE: Kling-Gupta efficiency</span>
<span class="sd">            - FHV: Peak flow bias (top 2%)</span>
<span class="sd">            - FLV: Low flow bias (bottom 30%)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If there are fewer than 2 valid data points for correlation.</span>

<span class="sd">    Note:</span>
<span class="sd">        - NaN values are automatically handled (removed from calculations)</span>
<span class="sd">        - FHV and FLV are calculated in percentage</span>
<span class="sd">        - All metrics are calculated on valid (non-NaN) data points only</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; target = np.array([1.0, 2.0, 3.0, np.nan, 5.0])</span>
<span class="sd">        &gt;&gt;&gt; predicted = np.array([1.1, 2.2, 2.9, np.nan, 4.8])</span>
<span class="sd">        &gt;&gt;&gt; metrics = stat_error_i(target, predicted)</span>
<span class="sd">        &gt;&gt;&gt; print(metrics[&#39;RMSE&#39;])  # Example output</span>
<span class="sd">        0.173</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">pred_i</span><span class="p">),</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">targ_i</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Theoretically at least two points for correlation</span>
    <span class="k">if</span> <span class="n">ind</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">xx</span> <span class="o">=</span> <span class="n">pred_i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">yy</span> <span class="o">=</span> <span class="n">targ_i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
        <span class="n">bias</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">me</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># RMSE</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">rmse</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># ubRMSE</span>
        <span class="n">pred_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">target_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="n">pred_anom</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">-</span> <span class="n">pred_mean</span>
        <span class="n">target_anom</span> <span class="o">=</span> <span class="n">yy</span> <span class="o">-</span> <span class="n">target_mean</span>
        <span class="n">ubrmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">((</span><span class="n">pred_anom</span> <span class="o">-</span> <span class="n">target_anom</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="c1"># rho R2 NSE</span>
        <span class="n">corr</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">pearson_r</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">r_squared</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">nse</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">nse</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="n">kge</span> <span class="o">=</span> <span class="n">he</span><span class="o">.</span><span class="n">kge_2009</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        <span class="c1"># percent bias</span>
        <span class="n">pbias</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xx</span> <span class="o">-</span> <span class="n">yy</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="c1"># FHV the peak flows bias 2%</span>
        <span class="c1"># FLV the low flows bias bottom 30%, log space</span>
        <span class="n">pred_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
        <span class="n">target_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span>
        <span class="n">indexlow</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.3</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
        <span class="n">indexhigh</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="mf">0.98</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">pred_sort</span><span class="p">))</span>
        <span class="n">lowpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
        <span class="n">highpred</span> <span class="o">=</span> <span class="n">pred_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
        <span class="n">lowtarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[:</span><span class="n">indexlow</span><span class="p">]</span>
        <span class="n">hightarget</span> <span class="o">=</span> <span class="n">target_sort</span><span class="p">[</span><span class="n">indexhigh</span><span class="p">:]</span>
        <span class="n">pbiaslow</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowpred</span> <span class="o">-</span> <span class="n">lowtarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">lowtarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="n">pbiashigh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">highpred</span> <span class="o">-</span> <span class="n">hightarget</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hightarget</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="n">Bias</span><span class="o">=</span><span class="n">bias</span><span class="p">,</span>
            <span class="n">RMSE</span><span class="o">=</span><span class="n">rmse</span><span class="p">,</span>
            <span class="n">ubRMSE</span><span class="o">=</span><span class="n">ubrmse</span><span class="p">,</span>
            <span class="n">Corr</span><span class="o">=</span><span class="n">corr</span><span class="p">,</span>
            <span class="n">R2</span><span class="o">=</span><span class="n">r2</span><span class="p">,</span>
            <span class="n">NSE</span><span class="o">=</span><span class="n">nse</span><span class="p">,</span>
            <span class="n">KGE</span><span class="o">=</span><span class="n">kge</span><span class="p">,</span>
            <span class="n">FHV</span><span class="o">=</span><span class="n">pbiashigh</span><span class="p">,</span>
            <span class="n">FLV</span><span class="o">=</span><span class="n">pbiaslow</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The number of data is less than 2, we don&#39;t calculate the statistics.&quot;</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.stat_errors" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">stat_errors</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">fill_nan</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.stat_errors" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Calculate statistical metrics for 3D arrays with multiple variables.</p>
<p>This function extends stat_error to handle 3D arrays where the third dimension
represents different variables. Each variable can have its own NaN handling
method.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target (observed) values. 3D array [basin, sequence, variable].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pred</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Predicted values. Same shape as target.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_nan</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of NaN handling methods, one per variable.
Each element can be "no", "sum", or "mean". Defaults to ["no"].</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.List">List</span>[<span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="numpy.ndarray">ndarray</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List[Dict[str, np.ndarray]]: List of dictionaries, one per variable.
Each dictionary contains:
- Bias: Mean error
- RMSE: Root mean square error
- ubRMSE: Unbiased root mean square error
- Corr: Pearson correlation coefficient
- R2: Coefficient of determination
- NSE: Nash-Sutcliffe efficiency
- KGE: Kling-Gupta efficiency
- FHV: Peak flow bias (top 2%)
- FLV: Low flow bias (bottom 30%)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If:
- Input arrays are not 3D
- Arrays have incompatible shapes
- fill_nan length doesn't match number of variables</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>target = np.array([[[1.0, 2.0], [np.nan, 4.0], [5.0, 6.0]]])  # 1x3x2
pred = np.array([[[1.1, 2.1], [3.0, 3.9], [4.9, 5.8]]])
metrics = stat_errors(target, pred, fill_nan=["no", "sum"])
print(len(metrics))  # Number of variables
2
print(metrics[0]['RMSE'])  # RMSE for first variable
array([0.141])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">stat_errors</span><span class="p">(</span>
    <span class="n">target</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pred</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">fill_nan</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate statistical metrics for 3D arrays with multiple variables.</span>

<span class="sd">    This function extends stat_error to handle 3D arrays where the third dimension</span>
<span class="sd">    represents different variables. Each variable can have its own NaN handling</span>
<span class="sd">    method.</span>

<span class="sd">    Args:</span>
<span class="sd">        target (np.ndarray): Target (observed) values. 3D array [basin, sequence, variable].</span>
<span class="sd">        pred (np.ndarray): Predicted values. Same shape as target.</span>
<span class="sd">        fill_nan (List[str], optional): List of NaN handling methods, one per variable.</span>
<span class="sd">            Each element can be &quot;no&quot;, &quot;sum&quot;, or &quot;mean&quot;. Defaults to [&quot;no&quot;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Dict[str, np.ndarray]]: List of dictionaries, one per variable.</span>
<span class="sd">            Each dictionary contains:</span>
<span class="sd">            - Bias: Mean error</span>
<span class="sd">            - RMSE: Root mean square error</span>
<span class="sd">            - ubRMSE: Unbiased root mean square error</span>
<span class="sd">            - Corr: Pearson correlation coefficient</span>
<span class="sd">            - R2: Coefficient of determination</span>
<span class="sd">            - NSE: Nash-Sutcliffe efficiency</span>
<span class="sd">            - KGE: Kling-Gupta efficiency</span>
<span class="sd">            - FHV: Peak flow bias (top 2%)</span>
<span class="sd">            - FLV: Low flow bias (bottom 30%)</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If:</span>
<span class="sd">            - Input arrays are not 3D</span>
<span class="sd">            - Arrays have incompatible shapes</span>
<span class="sd">            - fill_nan length doesn&#39;t match number of variables</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; target = np.array([[[1.0, 2.0], [np.nan, 4.0], [5.0, 6.0]]])  # 1x3x2</span>
<span class="sd">        &gt;&gt;&gt; pred = np.array([[[1.1, 2.1], [3.0, 3.9], [4.9, 5.8]]])</span>
<span class="sd">        &gt;&gt;&gt; metrics = stat_errors(target, pred, fill_nan=[&quot;no&quot;, &quot;sum&quot;])</span>
<span class="sd">        &gt;&gt;&gt; print(len(metrics))  # Number of variables</span>
<span class="sd">        2</span>
<span class="sd">        &gt;&gt;&gt; print(metrics[0][&#39;RMSE&#39;])  # RMSE for first variable</span>
<span class="sd">        array([0.141])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fill_nan</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fill_nan</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;no&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;The input data should be 3-dim, not 2-dim. If you want to calculate &quot;</span>
            <span class="s2">&quot;metrics for 2-d arrays, please use stat_error function.&quot;</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">pred</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The shape of target and pred should be the same.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">fill_nan</span><span class="p">)</span> <span class="o">!=</span> <span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Please give same length of fill_nan as the number of variables.&quot;</span>
        <span class="p">)</span>
    <span class="n">dict_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">k_dict</span> <span class="o">=</span> <span class="n">stat_error</span><span class="p">(</span><span class="n">target</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">pred</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">],</span> <span class="n">fill_nan</span><span class="o">=</span><span class="n">fill_nan</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
        <span class="n">dict_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dict_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.trans_norm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">trans_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var_lst</span><span class="p">,</span> <span class="n">stat_dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">to_norm</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.trans_norm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Normalize or denormalize data using statistical parameters.</p>
<p>This function performs normalization or denormalization on 2D or 3D data
arrays using pre-computed statistical parameters. It supports multiple
variables and can handle both site-based and time series data.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Input data array:
- 2D: [sites, variables]
- 3D: [sites, time, variables]</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>var_lst</code>
            </td>
            <td>
                  <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="str">str</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Variable name(s) to process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>stat_dict</code>
            </td>
            <td>
                  <code><span title="typing.Dict">Dict</span>[<span title="str">str</span>, <span title="typing.List">List</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary containing statistics
for each variable. Each value is [p10, p90, mean, std].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>to_norm</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, normalize data; if False, denormalize data.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>np.ndarray: Normalized or denormalized data with same shape as input.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Normalization: (x - mean) / std</li>
<li>Denormalization: x * std + mean</li>
<li>Statistics should be pre-computed for each variable</li>
<li>Handles single variable (str) or multiple variables (list)</li>
<li>Preserves input array dimensions</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<h3 id="hydroutils.hydro_stat.trans_norm--normalization-example">Normalization example<a class="headerlink" href="#hydroutils.hydro_stat.trans_norm--normalization-example" title="Permanent link">&para;</a></h3>
<p>data = np.array([[1.0, 2.0], [3.0, 4.0]])  # 2 sites, 2 variables
stats = {'var1': [0, 2, 1, 0.5], 'var2': [1, 5, 3, 1.0]}
vars = ['var1', 'var2']
normalized = trans_norm(data, vars, stats, to_norm=True)
print(normalized)  # Example output
array([[0. , -1.],
       [4. ,  1.]])</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trans_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">var_lst</span><span class="p">,</span> <span class="n">stat_dict</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">to_norm</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize or denormalize data using statistical parameters.</span>

<span class="sd">    This function performs normalization or denormalization on 2D or 3D data</span>
<span class="sd">    arrays using pre-computed statistical parameters. It supports multiple</span>
<span class="sd">    variables and can handle both site-based and time series data.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (np.ndarray): Input data array:</span>
<span class="sd">            - 2D: [sites, variables]</span>
<span class="sd">            - 3D: [sites, time, variables]</span>
<span class="sd">        var_lst (Union[str, List[str]]): Variable name(s) to process.</span>
<span class="sd">        stat_dict (Dict[str, List[float]]): Dictionary containing statistics</span>
<span class="sd">            for each variable. Each value is [p10, p90, mean, std].</span>
<span class="sd">        to_norm (bool): If True, normalize data; if False, denormalize data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: Normalized or denormalized data with same shape as input.</span>

<span class="sd">    Note:</span>
<span class="sd">        - Normalization: (x - mean) / std</span>
<span class="sd">        - Denormalization: x * std + mean</span>
<span class="sd">        - Statistics should be pre-computed for each variable</span>
<span class="sd">        - Handles single variable (str) or multiple variables (list)</span>
<span class="sd">        - Preserves input array dimensions</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; # Normalization example</span>
<span class="sd">        &gt;&gt;&gt; data = np.array([[1.0, 2.0], [3.0, 4.0]])  # 2 sites, 2 variables</span>
<span class="sd">        &gt;&gt;&gt; stats = {&#39;var1&#39;: [0, 2, 1, 0.5], &#39;var2&#39;: [1, 5, 3, 1.0]}</span>
<span class="sd">        &gt;&gt;&gt; vars = [&#39;var1&#39;, &#39;var2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; normalized = trans_norm(data, vars, stats, to_norm=True)</span>
<span class="sd">        &gt;&gt;&gt; print(normalized)  # Example output</span>
<span class="sd">        array([[0. , -1.],</span>
<span class="sd">               [4. ,  1.]])</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">var_lst</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">var_lst</span> <span class="o">=</span> <span class="p">[</span><span class="n">var_lst</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_lst</span><span class="p">)):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">var_lst</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">stat</span> <span class="o">=</span> <span class="n">stat_dict</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">to_norm</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">out</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">-</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">out</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*</span> <span class="n">stat</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">stat</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.wilcoxon_t_test" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wilcoxon_t_test</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">xo</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.wilcoxon_t_test" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Perform Wilcoxon signed-rank test on paired samples.</p>
<p>This function performs a Wilcoxon signed-rank test to determine whether two
related samples have the same distribution. It's particularly useful for
comparing model predictions against observations.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xs</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>First sample (typically simulated/predicted values).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xo</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Second sample (typically observed values).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="typing.Tuple">Tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[float, float]: Test statistics:
- w: Wilcoxon test statistic
- p: p-value for the test</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Non-parametric alternative to paired t-test</li>
<li>Assumes samples are paired and same length</li>
<li>Direction of difference (xs-xo vs xo-xs) doesn't affect results</li>
<li>Uses scipy.stats.wilcoxon under the hood</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>sim = np.array([102, 104, 98, 101, 96, 103, 95])
obs = np.array([100, 102, 95, 100, 93, 101, 94])
w, p = wilcoxon_t_test(sim, obs)
print(f"W-statistic: {w:.2f}, p-value: {p:.4f}")
W-statistic: 26.50, p-value: 0.0234</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test</span><span class="p">(</span><span class="n">xs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">xo</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform Wilcoxon signed-rank test on paired samples.</span>

<span class="sd">    This function performs a Wilcoxon signed-rank test to determine whether two</span>
<span class="sd">    related samples have the same distribution. It&#39;s particularly useful for</span>
<span class="sd">    comparing model predictions against observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        xs (np.ndarray): First sample (typically simulated/predicted values).</span>
<span class="sd">        xo (np.ndarray): Second sample (typically observed values).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[float, float]: Test statistics:</span>
<span class="sd">            - w: Wilcoxon test statistic</span>
<span class="sd">            - p: p-value for the test</span>

<span class="sd">    Note:</span>
<span class="sd">        - Non-parametric alternative to paired t-test</span>
<span class="sd">        - Assumes samples are paired and same length</span>
<span class="sd">        - Direction of difference (xs-xo vs xo-xs) doesn&#39;t affect results</span>
<span class="sd">        - Uses scipy.stats.wilcoxon under the hood</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; sim = np.array([102, 104, 98, 101, 96, 103, 95])</span>
<span class="sd">        &gt;&gt;&gt; obs = np.array([100, 102, 95, 100, 93, 101, 94])</span>
<span class="sd">        &gt;&gt;&gt; w, p = wilcoxon_t_test(sim, obs)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;W-statistic: {w:.2f}, p-value: {p:.4f}&quot;)</span>
<span class="sd">        W-statistic: 26.50, p-value: 0.0234</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">xs</span> <span class="o">-</span> <span class="n">xo</span>  <span class="c1"># same result when using xo-xs</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">wilcoxon</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wilcoxon_t_test_for_lst</span><span class="p">(</span><span class="n">x_lst</span><span class="p">,</span> <span class="n">rnd_num</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#hydroutils.hydro_stat.wilcoxon_t_test_for_lst" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Perform pairwise Wilcoxon tests on multiple arrays.</p>
<p>This function performs Wilcoxon signed-rank tests on every possible pair
of arrays in a list of arrays. Results are rounded to specified precision.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x_lst</code>
            </td>
            <td>
                  <code><span title="typing.List">List</span>[<span title="numpy.ndarray">ndarray</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of arrays to compare pairwise.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rnd_num</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of decimal places to round results to.
Defaults to 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Tuple[List[float], List[float]]: Two lists:
- w: List of Wilcoxon test statistics for each pair
- p: List of p-values for each pair</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Note</summary>
  <ul>
<li>Generates all possible pairs using itertools.combinations</li>
<li>Results are ordered by pair combinations</li>
<li>Number of pairs = n*(n-1)/2 where n is number of arrays</li>
<li>All test statistics and p-values are rounded</li>
</ul>
</details>

<details class="example" open>
  <summary>Example</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>arrays = [
...     np.array([1, 2, 3, 4]),
...     np.array([2, 3, 4, 5]),
...     np.array([3, 4, 5, 6])
... ]
w, p = wilcoxon_t_test_for_lst(arrays)
print(f"W-statistics: {w}")
W-statistics: [0.00, 0.00, 0.00]
print(f"p-values: {p}")
p-values: [0.07, 0.07, 0.07]</p>
</blockquote>
</blockquote>
</blockquote>
</details>

            <details class="quote">
              <summary>Source code in <code>hydroutils\hydro_stat.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">wilcoxon_t_test_for_lst</span><span class="p">(</span><span class="n">x_lst</span><span class="p">,</span> <span class="n">rnd_num</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Perform pairwise Wilcoxon tests on multiple arrays.</span>

<span class="sd">    This function performs Wilcoxon signed-rank tests on every possible pair</span>
<span class="sd">    of arrays in a list of arrays. Results are rounded to specified precision.</span>

<span class="sd">    Args:</span>
<span class="sd">        x_lst (List[np.ndarray]): List of arrays to compare pairwise.</span>
<span class="sd">        rnd_num (int, optional): Number of decimal places to round results to.</span>
<span class="sd">            Defaults to 2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[List[float], List[float]]: Two lists:</span>
<span class="sd">            - w: List of Wilcoxon test statistics for each pair</span>
<span class="sd">            - p: List of p-values for each pair</span>

<span class="sd">    Note:</span>
<span class="sd">        - Generates all possible pairs using itertools.combinations</span>
<span class="sd">        - Results are ordered by pair combinations</span>
<span class="sd">        - Number of pairs = n*(n-1)/2 where n is number of arrays</span>
<span class="sd">        - All test statistics and p-values are rounded</span>

<span class="sd">    Example:</span>
<span class="sd">        &gt;&gt;&gt; arrays = [</span>
<span class="sd">        ...     np.array([1, 2, 3, 4]),</span>
<span class="sd">        ...     np.array([2, 3, 4, 5]),</span>
<span class="sd">        ...     np.array([3, 4, 5, 6])</span>
<span class="sd">        ... ]</span>
<span class="sd">        &gt;&gt;&gt; w, p = wilcoxon_t_test_for_lst(arrays)</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;W-statistics: {w}&quot;)</span>
<span class="sd">        W-statistics: [0.00, 0.00, 0.00]</span>
<span class="sd">        &gt;&gt;&gt; print(f&quot;p-values: {p}&quot;)</span>
<span class="sd">        p-values: [0.07, 0.07, 0.07]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">arr_lst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_lst</span><span class="p">)</span>
    <span class="n">w</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">arr_lst_pair</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">arr_lst</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">arr_pair</span> <span class="ow">in</span> <span class="n">arr_lst_pair</span><span class="p">:</span>
        <span class="n">wi</span><span class="p">,</span> <span class="n">pi</span> <span class="o">=</span> <span class="n">wilcoxon_t_test</span><span class="p">(</span><span class="n">arr_pair</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">arr_pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">w</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">wi</span><span class="p">,</span> <span class="n">rnd_num</span><span class="p">))</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">rnd_num</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">w</span><span class="p">,</span> <span class="n">p</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    2025-08-20
  </span>

    
    
    
    
  </aside>





                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.instant", "search.highlight"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>